# 数据指标体系重构需求文档

## 1. 问题概述

当前数字员工管理平台存在指标体系不一致的问题，主要体现在：

1. **文档与实际实现不一致**：
   - 技术文档《指标标准模板规范.md》中定义了 L1/L2/L3 三层指标体系
   - 实际代码中（如 `metrics-definitions.ts`）却实现了 L1/L2/L3/L4 四层指标体系
   - 部分代码中仍保留着旧的 L3 技术监控指标定义

2. **不同模块使用不同指标层级**：
   - 仪表盘模块使用 L1/L2/L3 三层指标体系
   - A/B 实验的「三层指标」tab 和数据分析页面使用 L1/L2/L3/L4 四层指标体系
   - 这种不一致导致用户理解混乱，也增加了开发和维护成本

3. **指标分类标准不统一**：
   - L3 指标同时包含成本性能指标和技术监控指标
   - 缺乏清晰的分类标准和定义

## 2. 重构目标

1. **统一指标层级定义**：明确界定 L1/L2/L3/L4 各层级指标的含义和范围
2. **标准化指标分类**：建立清晰的指标分类标准和命名规范
3. **对齐文档与代码**：确保技术文档与实际代码实现完全一致
4. **优化用户体验**：提供一致的指标展示和分析体验
5. **降低维护成本**：减少因不一致性导致的重复开发和维护工作

## 3. 重构方案

### 3.1 指标层级重新定义

| 层级 | 名称                 | 英文标识         | 描述                                                                 |
|------|----------------------|------------------|----------------------------------------------------------------------|
| L1   | 核心业务指标         | Core Business    | 衡量业务价值和核心目标达成情况的关键指标，回答"是否创造了价值？"       |
| L2   | 对话体验指标         | Conversation     | 衡量用户体验和交互效率的指标，回答"体验是否高效顺畅？"                 |
| L3   | 成本性能指标         | Cost & Performance | 衡量系统性能和成本效益的指标，回答"付出的代价是多少？"               |
| L4   | 运维安全指标         | Operations & Security | 衡量系统稳定性和安全性的指标，回答"是否稳定可靠？"                  |

### 3.2 指标分类调整

1. **取消旧的 L3 技术监控指标**，将其内容拆分到 L3 成本性能指标和 L4 运维安全指标中
2. **明确各类指标的范围和计算方法**，避免重叠和模糊定义
3. **统一指标命名规范**，采用 `{category}_{subcategory}_{name}` 的格式

### 3.3 具体模块调整

#### 3.3.1 仪表盘模块
- 升级仪表盘以支持 L1/L2/L3/L4 四层指标体系
- 提供层级筛选功能，允许用户根据需要查看不同层级的指标
- 更新仪表盘数据展示逻辑，确保与新的指标定义一致

#### 3.3.2 A/B 实验模块
- 重命名「三层指标」tab 为「指标分析」或「全层级指标」
- 统一 A/B 实验中的指标选择和展示逻辑
- 确保实验结果分析使用统一的指标定义

#### 3.3.3 数据分析模块
- 保持 L1/L2/L3/L4 四层指标体系，但更新指标定义以符合新的标准
- 优化数据可视化组件，确保指标展示一致
- 提供指标详情查询功能，帮助用户理解指标定义和计算方法

### 3.4 代码重构

1. **更新类型定义**：
   - 修改 `metric-types.ts` 中的 `MetricLevel` 枚举，添加 L4 层级
   - 确保所有指标定义符合新的层级和分类标准

2. **统一指标数据源**：
   - 整合分散的指标数据收集逻辑
   - 建立统一的指标计算和存储服务

3. **重构指标展示组件**：
   - 更新所有使用指标的组件，确保一致展示
   - 建立可复用的指标展示组件库

## 4. 实施路径

### 4.1 阶段一：准备与规划（2周）
- 完成指标体系重构需求文档
- 成立重构专项小组
- 制定详细的实施计划和风险应对策略

### 4.2 阶段二：核心代码重构（3周）
- 更新类型定义和指标模型
- 重构指标计算和存储服务
- 修改核心业务逻辑以使用新的指标体系

### 4.3 阶段三：模块升级（4周）
- 升级仪表盘模块
- 重构 A/B 实验模块
- 更新数据分析模块
- 优化用户界面和交互

### 4.4 阶段四：测试与验证（2周）
- 单元测试和集成测试
- 用户 acceptance 测试
- 数据一致性验证
- 性能测试

### 4.5 阶段五：上线与监控（持续）
- 分批次上线重构后的功能
- 密切监控系统运行状况
- 收集用户反馈并持续优化

## 5. 影响分析

### 5.1 对现有功能的影响
- 仪表盘、A/B 实验和数据分析模块的指标展示和分析逻辑将发生变化
- 部分旧指标可能被重命名或重新分类
- 数据历史可能需要迁移或转换

### 5.2 对用户的影响
- 用户需要重新熟悉统一后的指标体系
- 部分报告和分析结果的格式可能发生变化
- 长期来看，用户体验将得到显著提升

### 5.3 对开发的影响
- 短期需要投入较多资源进行重构
- 长期将降低维护成本，提高开发效率
- 代码质量和一致性将得到提升

## 6. 质量保障

1. **代码审查**：确保所有重构代码经过严格审查
2. **自动化测试**：建立全面的测试套件，包括单元测试、集成测试和端到端测试
3. **数据验证**：确保重构前后的数据一致性和准确性
4. **文档更新**：及时更新技术文档和用户手册
5. **用户培训**：提供必要的培训和支持，帮助用户适应新的指标体系

## 7. 附录

### 7.1 指标体系对照表
（列出重构前后的指标名称、层级和分类对应关系）

### 7.2 关键指标定义
（详细定义核心指标的计算方法、数据源和阈值）