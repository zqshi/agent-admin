# 数字员工管理平台指标标准模板规范

**版本**: v1.0  
**创建日期**: 2024-08-25  
**维护团队**: 数据团队  
**适用范围**: 全平台所有模块

## 1. 概述

本文档定义了数字员工管理平台的指标标准模板，旨在解决现有指标体系中的不一致性问题，确保所有模块的指标定义、命名、格式和治理保持统一。

### 1.1 设计原则

- **一致性**: 所有指标遵循统一的命名和格式规范
- **可扩展性**: 支持新指标的标准化添加
- **可追踪性**: 每个指标都有完整的元数据和版本信息
- **可验证性**: 提供自动化的一致性检测机制

### 1.2 解决的问题

- ✅ 指标定义重复和分散
- ✅ 命名规范不统一
- ✅ 数据格式和单位不一致
- ✅ 缺乏版本控制和治理机制

## 2. 指标标准定义

### 2.1 核心指标接口

```typescript
/**
 * 标准化指标定义接口
 */
interface StandardMetricDefinition {
  // 基础标识
  id: string;                    // 全局唯一标识符，格式：{category}_{name}
  name: string;                  // 标准化名称，使用驼峰命名
  displayName: string;           // 显示名称（中文）
  
  // 分类信息
  category: MetricCategory;      // 指标分类
  level: MetricLevel;            // 指标层级 (L1/L2/L3)
  domain: string[];              // 适用业务域
  
  // 定义详情
  description: string;           // 详细描述
  formula: string;               // 计算公式
  unit: MetricUnit;              // 标准单位
  dataType: MetricDataType;      // 数据类型
  
  // 格式规范
  format: MetricFormat;          // 显示格式配置
  precision: number;             // 小数精度
  range?: {                      // 有效值范围
    min?: number;
    max?: number;
  };
  
  // 质量标准
  qualityThresholds: {           // 质量阈值
    excellent: number;           // 优秀阈值
    good: number;               // 良好阈值
    warning: number;            // 警告阈值
    critical: number;           // 严重阈值
  };
  
  // 治理信息
  governance: {
    owner: string;              // 指标负责人
    reviewCycle: string;        // 审查周期
    lastReviewed: string;       // 最近审查日期
    approvalStatus: 'draft' | 'approved' | 'deprecated';
  };
  
  // 版本控制
  version: string;               // 版本号
  changeHistory: MetricChange[];  // 变更历史
  
  // 关联关系
  dependencies?: string[];       // 依赖的其他指标
  derivedMetrics?: string[];     // 派生指标
  
  // 标签和元数据
  tags: string[];               // 标签，便于分类和搜索
  metadata?: Record<string, any>; // 额外元数据
}
```

### 2.2 枚举定义

```typescript
/**
 * 指标分类
 */
enum MetricCategory {
  BUSINESS = 'business',         // 业务指标
  PERFORMANCE = 'performance',   // 性能指标
  QUALITY = 'quality',          // 质量指标
  COST = 'cost',                // 成本指标
  USER = 'user',                // 用户指标
  SYSTEM = 'system',            // 系统指标
  SECURITY = 'security'         // 安全指标
}

/**
 * 指标层级
 */
enum MetricLevel {
  L1 = 'L1',  // 核心业务指标
  L2 = 'L2',  // 支撑分析指标  
  L3 = 'L3'   // 技术监控指标
}

/**
 * 标准单位
 */
enum MetricUnit {
  // 数量单位
  COUNT = 'count',               // 次数/个数
  PERCENTAGE = 'percentage',     // 百分比 (0-100)
  RATIO = 'ratio',              // 比率 (0-1)
  RATE = 'rate',                // 速率 (次/时间单位)
  
  // 时间单位 (统一使用毫秒作为基础单位)
  MILLISECONDS = 'milliseconds', // 毫秒
  SECONDS = 'seconds',          // 秒
  MINUTES = 'minutes',          // 分钟
  HOURS = 'hours',              // 小时
  DAYS = 'days',                // 天
  
  // 数据单位
  BYTES = 'bytes',              // 字节
  KILOBYTES = 'kilobytes',      // KB
  MEGABYTES = 'megabytes',      // MB
  GIGABYTES = 'gigabytes',      // GB
  
  // 货币单位
  CNY = 'cny',                  // 人民币
  USD = 'usd',                  // 美元
  
  // 分数单位
  SCORE = 'score',              // 评分 (通常1-5或1-10)
  
  // 无量纲
  DIMENSIONLESS = 'dimensionless' // 无量纲
}

/**
 * 数据类型
 */
enum MetricDataType {
  INTEGER = 'integer',          // 整数
  FLOAT = 'float',              // 浮点数
  BOOLEAN = 'boolean',          // 布尔值
  STRING = 'string',            // 字符串
  TIMESTAMP = 'timestamp'       // 时间戳
}

/**
 * 显示格式配置
 */
interface MetricFormat {
  displayType: 'number' | 'percentage' | 'currency' | 'duration' | 'size';
  thousandsSeparator: boolean;  // 是否显示千位分隔符
  prefix?: string;              // 前缀
  suffix?: string;              // 后缀
  colorMapping?: {              // 颜色映射规则
    excellent: string;          // 优秀值颜色
    good: string;              // 良好值颜色  
    warning: string;           // 警告值颜色
    critical: string;          // 严重值颜色
  };
}

/**
 * 指标变更记录
 */
interface MetricChange {
  version: string;              // 版本号
  date: string;                 // 变更日期
  author: string;               // 变更者
  type: 'create' | 'modify' | 'deprecate'; // 变更类型
  description: string;          // 变更描述
  impactAssessment?: string;    // 影响评估
  rollbackPlan?: string;        // 回滚方案
}
```

## 3. 命名规范

### 3.1 指标ID命名规范

**格式**: `{category}_{domain}_{name}`

**示例**:
- `business_user_taskSuccessRate`
- `performance_system_responseTime`
- `cost_token_avgCostPerSession`

### 3.2 指标名称命名规范

**原则**:
- 使用驼峰命名法 (camelCase)
- 名称要清晰、准确、无歧义
- 避免缩写，除非是行业标准缩写

**标准命名模式**:

#### 时间相关指标
- `responseTime` - 响应时间
- `avgResponseTime` - 平均响应时间
- `p95ResponseTime` - P95响应时间
- `maxResponseTime` - 最大响应时间
- `processingTime` - 处理时间
- `waitTime` - 等待时间

#### 成功率相关指标
- `successRate` - 成功率
- `taskSuccessRate` - 任务成功率  
- `toolCallSuccessRate` - 工具调用成功率
- `sessionSuccessRate` - 会话成功率

#### 失败相关指标
- `failureRate` - 失败率
- `errorRate` - 错误率
- `retryRate` - 重试率
- `timeoutRate` - 超时率

#### 数量相关指标
- `totalSessions` - 总会话数
- `activeSessions` - 活跃会话数
- `completedSessions` - 完成会话数
- `failedSessions` - 失败会话数

#### 成本相关指标
- `totalCost` - 总成本
- `avgCostPerSession` - 每会话平均成本
- `costPerToken` - 每Token成本
- `dailyCost` - 日成本

### 3.3 禁用的命名方式

❌ **禁止的命名**:
- 使用不明确的缩写: `respTime`, `succRate`
- 使用下划线: `response_time`, `success_rate`
- 混合单位表示: `responseTimeSeconds`, `costInCNY`

✅ **推荐的命名**:
- `responseTime` (配合unit: MILLISECONDS)
- `successRate` (配合unit: PERCENTAGE)
- `totalCost` (配合unit: CNY)

## 4. 数据格式和单位标准

### 4.1 时间指标标准

**基础单位**: 毫秒 (MILLISECONDS)

**转换规则**:
```typescript
// 内部存储统一使用毫秒
const responseTimeMs = 1500; // 1.5秒

// 显示时根据数值大小自动选择合适单位
const displayTime = formatTime(responseTimeMs); 
// 结果: "1.5s" 或 "1500ms"

// 标准转换函数
const conversions = {
  toSeconds: (ms: number) => ms / 1000,
  toMinutes: (ms: number) => ms / 60000,
  toHours: (ms: number) => ms / 3600000
};
```

### 4.2 百分比指标标准

**存储格式**: 0-100 范围的数值
**单位标识**: PERCENTAGE

```typescript
// 统一使用0-100范围
const successRate = 95.5; // 表示95.5%
const failureRate = 4.5;  // 表示4.5%

// 显示格式
const displayRate = `${successRate.toFixed(1)}%`; // "95.5%"
```

### 4.3 货币指标标准

**基础单位**: 人民币分 (存储时使用最小单位避免浮点精度问题)
**显示单位**: 人民币元

```typescript
// 存储时使用分
const costInCents = 12345; // 123.45元

// 显示时转换为元
const costInYuan = costInCents / 100; // 123.45
const displayCost = `¥${costInYuan.toFixed(2)}`; // "¥123.45"
```

### 4.4 数值精度标准

**整数类型**: 不使用小数
**浮点数类型**: 根据指标特性设定精度

```typescript
const precisionRules = {
  // 时间指标
  responseTime: 1,        // 1位小数: 1.5s
  
  // 百分比指标  
  successRate: 1,         // 1位小数: 95.5%
  
  // 成本指标
  avgCostPerSession: 2,   // 2位小数: 12.34元
  
  // 评分指标
  satisfactionScore: 1,   // 1位小数: 4.2分
  
  // 计数指标
  totalSessions: 0,       // 整数: 1234
};
```

## 5. 指标分层体系标准

### 5.1 L1 核心业务指标

**定义**: 直接反映业务价值和用户体验的关键指标

**标准指标模板**:
```typescript
const l1MetricTemplate: Partial<StandardMetricDefinition> = {
  level: MetricLevel.L1,
  category: MetricCategory.BUSINESS,
  qualityThresholds: {
    excellent: 90,
    good: 75,
    warning: 60,
    critical: 45
  },
  governance: {
    reviewCycle: 'monthly',
    approvalStatus: 'approved'
  }
};
```

### 5.2 L2 支撑分析指标

**定义**: 支撑L1指标分析和诊断的中间层指标

**标准指标模板**:
```typescript
const l2MetricTemplate: Partial<StandardMetricDefinition> = {
  level: MetricLevel.L2,
  category: MetricCategory.QUALITY,
  qualityThresholds: {
    excellent: 85,
    good: 70,
    warning: 55,
    critical: 40
  },
  governance: {
    reviewCycle: 'quarterly',
    approvalStatus: 'approved'
  }
};
```

### 5.3 L3 技术监控指标

**定义**: 技术层面的监控和运维指标

**标准指标模板**:
```typescript
const l3MetricTemplate: Partial<StandardMetricDefinition> = {
  level: MetricLevel.L3,
  category: MetricCategory.PERFORMANCE,
  qualityThresholds: {
    excellent: 95,
    good: 85,
    warning: 70,
    critical: 50
  },
  governance: {
    reviewCycle: 'quarterly',
    approvalStatus: 'approved'
  }
};
```

## 6. 标准指标注册表

### 6.1 业务指标 (L1)

| 指标ID | 指标名称 | 显示名称 | 单位 | 计算公式 | 优秀阈值 |
|--------|----------|----------|------|----------|----------|
| `business_user_taskSuccessRate` | taskSuccessRate | 任务完成率 | PERCENTAGE | (成功完成任务的会话数 / 总会话数) × 100 | ≥90% |
| `business_user_userValueDensity` | userValueDensity | 用户价值密度 | SCORE | 总用户价值得分 / 总会话数 | ≥3.0 |
| `business_user_retentionRate7d` | retentionRate7d | 7日留存率 | PERCENTAGE | (7天内回访的新用户数 / 新用户总数) × 100 | ≥70% |
| `business_user_retentionRate30d` | retentionRate30d | 30日留存率 | PERCENTAGE | (30天内仍活跃的新用户数 / 新用户总数) × 100 | ≥40% |
| `business_user_userActivation` | userActivation | 新用户激活率 | PERCENTAGE | (完成激活行为的新用户数 / 新用户总数) × 100 | ≥75% |

### 6.2 支撑指标 (L2)

| 指标ID | 指标名称 | 显示名称 | 单位 | 计算公式 | 优秀阈值 |
|--------|----------|----------|------|----------|----------|
| `quality_interaction_effectiveDepth` | effectiveInteractionDepth | 有效交互深度 | COUNT | 所有会话的有效交互轮次总和 / 总会话数 | 2-5轮 |
| `quality_interaction_clarificationRatio` | clarificationRequestRatio | 澄清请求比例 | PERCENTAGE | (包含澄清请求的会话数 / 总会话数) × 100 | ≤10% |
| `quality_interaction_firstHitRate` | firstResponseHitRate | 首次命中率 | PERCENTAGE | (首次回复满足需求的会话数 / 总会话数) × 100 | ≥85% |
| `quality_resolution_timeToResolution` | timeToResolution | 问题解决时间 | SECONDS | 所有会话解决时间总和 / 成功解决问题的会话数 | ≤120秒 |
| `quality_knowledge_knowledgeCoverage` | knowledgeCoverage | 知识覆盖度 | PERCENTAGE | (能够回答的问题类型数 / 用户提出的问题类型总数) × 100 | ≥90% |

### 6.3 技术指标 (L3)

| 指标ID | 指标名称 | 显示名称 | 单位 | 计算公式 | 优秀阈值 |
|--------|----------|----------|------|----------|----------|
| `performance_system_responseTime` | avgResponseTime | 平均响应时间 | MILLISECONDS | 所有会话响应时间总和 / 总会话数 | ≤2000ms |
| `performance_system_p95ResponseTime` | p95ResponseTime | P95响应时间 | MILLISECONDS | 95%会话的响应时间上限 | ≤5000ms |
| `performance_session_successRate` | sessionSuccessRate | 会话成功率 | PERCENTAGE | (成功会话数 / 总会话数) × 100 | ≥95% |
| `cost_token_avgCostPerSession` | avgCostPerSession | 每会话平均成本 | CNY | 总Token成本 / 总会话数 | ≤1.00元 |
| `cost_token_totalCost` | totalCost | 总Token成本 | CNY | 所有模型调用成本总和 | 按预算设定 |
| `performance_tool_toolCallSuccessRate` | toolCallSuccessRate | 工具调用成功率 | PERCENTAGE | (成功工具调用数 / 总工具调用数) × 100 | ≥95% |
| `performance_system_retryRate` | retryRate | 重试率 | PERCENTAGE | (重试请求数 / 总请求数) × 100 | ≤5% |
| `performance_system_errorRate` | errorRate | 系统错误率 | PERCENTAGE | (系统错误次数 / 总请求数) × 100 | ≤2% |

## 7. 版本控制和治理

### 7.1 版本命名规范

**格式**: `{major}.{minor}.{patch}`

**变更类型**:
- **Major**: 指标定义发生根本性变化，不兼容旧版本
- **Minor**: 添加新字段或优化计算方式，兼容旧版本
- **Patch**: 修复错误或文档更新，完全兼容

### 7.2 指标生命周期管理

```typescript
enum MetricStatus {
  DRAFT = 'draft',           // 草稿状态，开发中
  REVIEW = 'review',         // 审核中
  APPROVED = 'approved',     // 已批准，正式使用
  DEPRECATED = 'deprecated', // 已废弃，计划移除
  RETIRED = 'retired'        // 已移除，不再使用
}
```

### 7.3 变更审批流程

1. **提议阶段**: 创建指标提案，说明业务需求
2. **设计阶段**: 按标准模板设计指标定义
3. **评审阶段**: 技术评审 + 业务评审
4. **测试阶段**: 在测试环境验证指标计算
5. **发布阶段**: 正式发布并更新文档
6. **监控阶段**: 持续监控指标质量和使用情况

## 8. 指标质量保证

### 8.1 数据质量检查

**必检项目**:
- ✅ 数据完整性: 无空值、无异常值
- ✅ 数据一致性: 跨系统数据一致
- ✅ 数据准确性: 抽样验证计算正确性
- ✅ 数据时效性: 更新频率符合要求

### 8.2 指标有效性验证

**验证维度**:
- **业务逻辑**: 计算公式符合业务定义
- **数学正确性**: 公式数学上正确无误
- **边界情况**: 处理除零、空集等边界情况
- **性能效率**: 计算复杂度可接受

### 8.3 异常检测和报警

**异常类型**:
- 数值异常: 超出合理范围
- 趋势异常: 突然变化超过阈值
- 计算异常: 计算失败或超时
- 依赖异常: 依赖指标不可用

## 9. 使用示例

### 9.1 标准指标定义示例

```typescript
const taskSuccessRateMetric: StandardMetricDefinition = {
  id: 'business_user_taskSuccessRate',
  name: 'taskSuccessRate',
  displayName: '任务完成率',
  
  category: MetricCategory.BUSINESS,
  level: MetricLevel.L1,
  domain: ['user_experience', 'business_outcome'],
  
  description: '用户成功完成预期任务的比例，是衡量产品核心价值实现程度的关键指标',
  formula: '(成功完成任务的会话数 / 总会话数) × 100',
  unit: MetricUnit.PERCENTAGE,
  dataType: MetricDataType.FLOAT,
  
  format: {
    displayType: 'percentage',
    thousandsSeparator: false,
    suffix: '%',
    colorMapping: {
      excellent: '#10B981', // 绿色
      good: '#3B82F6',      // 蓝色  
      warning: '#F59E0B',   // 黄色
      critical: '#EF4444'   // 红色
    }
  },
  precision: 1,
  range: { min: 0, max: 100 },
  
  qualityThresholds: {
    excellent: 90,
    good: 75,
    warning: 60,
    critical: 45
  },
  
  governance: {
    owner: '产品团队',
    reviewCycle: 'monthly',
    lastReviewed: '2024-08-25',
    approvalStatus: 'approved'
  },
  
  version: '1.0.0',
  changeHistory: [
    {
      version: '1.0.0',
      date: '2024-08-25',
      author: 'system',
      type: 'create',
      description: '创建任务完成率指标定义'
    }
  ],
  
  dependencies: [],
  derivedMetrics: ['business_user_userValueDensity'],
  
  tags: ['business', 'user', 'success', 'core'],
  metadata: {
    calculationFrequency: 'real-time',
    storageRetention: '2years',
    sensitivityLevel: 'internal'
  }
};
```

### 9.2 指标使用示例

```typescript
import { MetricRegistry, MetricValidator, MetricCalculator } from './metrics';

// 注册指标
MetricRegistry.register(taskSuccessRateMetric);

// 验证指标定义
const validation = MetricValidator.validate(taskSuccessRateMetric);
if (!validation.isValid) {
  console.error('指标定义不符合规范:', validation.errors);
}

// 计算指标值
const metricValue = MetricCalculator.calculate('business_user_taskSuccessRate', {
  successfulSessions: 456,
  totalSessions: 500
});

// 格式化显示
const displayValue = MetricFormatter.format(metricValue, taskSuccessRateMetric);
console.log(displayValue); // "91.2%"
```

## 10. 实施计划

### 10.1 第一阶段: 标准建立 (1周)
- ✅ 完成指标标准模板定义
- ✅ 创建 TypeScript 类型定义
- ⏳ 开发指标注册和验证工具
- ⏳ 创建指标注册表

### 10.2 第二阶段: 现有指标标准化 (2周)
- ⏳ 审查现有所有指标定义
- ⏳ 按标准模板重构现有指标
- ⏳ 更新所有相关代码和文档
- ⏳ 进行一致性检测和修复

### 10.3 第三阶段: 治理机制建立 (1周)
- ⏳ 建立指标评审流程
- ⏳ 部署自动化检测工具
- ⏳ 培训开发团队使用规范
- ⏳ 建立持续监控机制

## 11. 附录

### 11.1 参考资源

- [TypeScript 类型定义](./metric-types.ts)
- [指标验证工具](./metric-validator.ts)
- [指标注册表](./metric-registry.ts)
- [迁移指南](./migration-guide.md)

### 11.2 联系方式

- **技术负责人**: 数据团队
- **业务负责人**: 产品团队  
- **问题反馈**: [GitHub Issues](https://github.com/company/digital-employee-platform/issues)

---

**文档状态**: 正式版本  
**最后更新**: 2024-08-25  
**下次审查**: 2024-11-25