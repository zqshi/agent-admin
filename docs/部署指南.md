# KingSoft éƒ¨ç½²æŒ‡å—

## å¿«é€Ÿéƒ¨ç½²

### æ–¹å¼ä¸€ï¼šDocker Compose éƒ¨ç½² (æ¨è)

**1. å‡†å¤‡ç¯å¢ƒå˜é‡æ–‡ä»¶**
```bash
# åˆ›å»º .env æ–‡ä»¶
cat > .env << EOF
POSTGRES_PASSWORD=your-secure-postgres-password
REDIS_PASSWORD=your-secure-redis-password
INFLUXDB_PASSWORD=your-secure-influxdb-password
JWT_SECRET=your-jwt-secret-key
DOMAIN=kingsoft.yourdomain.com
EOF
```

**2. å¯åŠ¨æœåŠ¡**
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/kingsoft-admin.git
cd kingsoft-admin

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

**3. è®¿é—®åº”ç”¨**
- å‰ç«¯ç•Œé¢: http://localhost:3000
- APIæ–‡æ¡£: http://localhost:8080/api/docs

### æ–¹å¼äºŒï¼šKubernetes éƒ¨ç½²

**1. åˆ›å»ºå‘½åç©ºé—´å’Œé…ç½®**
```bash
# åº”ç”¨Kubernetesé…ç½®
kubectl apply -f k8s/

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get pods -n kingsoft
```

**2. é…ç½®åŸŸå**
```bash
# æ›´æ–°Ingressé…ç½®ä¸­çš„åŸŸå
kubectl patch ingress kingsoft-ingress -n kingsoft -p '{"spec":{"rules":[{"host":"your-domain.com"}]}}'
```

### æ–¹å¼ä¸‰ï¼šä¼ ç»Ÿéƒ¨ç½²

**å‰ç«¯éƒ¨ç½²:**
```bash
# æ„å»ºå‰ç«¯
npm ci
npm run build

# é…ç½®Nginx
sudo cp nginx.conf /etc/nginx/sites-available/kingsoft
sudo ln -s /etc/nginx/sites-available/kingsoft /etc/nginx/sites-enabled/
sudo systemctl reload nginx
```

**åç«¯éƒ¨ç½²:**
```bash
# å®‰è£…åç«¯ä¾èµ–
cd api && npm ci

# å¯åŠ¨åç«¯æœåŠ¡
npm run start:prod
```

## ç¯å¢ƒè¦æ±‚

| ç»„ä»¶ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|-----|---------|---------|
| **CPU** | 2æ ¸ | 4æ ¸+ |
| **å†…å­˜** | 4GB | 8GB+ |
| **ç£ç›˜** | 50GB | 100GB SSD |
| **æ“ä½œç³»ç»Ÿ** | Ubuntu 18.04+ | Ubuntu 20.04+ |
| **Node.js** | 18.x | 18.x LTS |
| **Docker** | 20.10+ | æœ€æ–°ç‰ˆæœ¬ |

## é…ç½®æ–‡ä»¶è¯´æ˜

### Docker Compose é…ç½®

ä¸»è¦æœåŠ¡é…ç½®åœ¨ `docker-compose.yml` ä¸­ï¼š

```yaml
services:
  frontend:    # React å‰ç«¯åº”ç”¨
  backend:     # Node.js åç«¯ API
  postgres:    # ä¸»æ•°æ®åº“
  influxdb:    # æ—¶åºæ•°æ®åº“
  redis:       # ç¼“å­˜æ•°æ®åº“
```

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-------|------|-------|
| `POSTGRES_PASSWORD` | PostgreSQL æ•°æ®åº“å¯†ç  | `secure-password-123` |
| `REDIS_PASSWORD` | Redis å¯†ç  | `redis-password-456` |
| `JWT_SECRET` | JWT ç­¾åå¯†é’¥ | `your-jwt-secret` |
| `DOMAIN` | åº”ç”¨åŸŸå | `kingsoft.example.com` |

## æ•°æ®åˆå§‹åŒ–

### æ•°æ®åº“åˆå§‹åŒ–

**PostgreSQL:**
```bash
# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker-compose exec postgres psql -U kingsoft_user -d kingsoft

# æ‰§è¡Œåˆå§‹åŒ–SQL
\i /docker-entrypoint-initdb.d/init.sql
```

**InfluxDB:**
```bash
# åˆ›å»ºåˆå§‹bucketå’Œç”¨æˆ·
docker-compose exec influxdb influx setup \
  --username admin \
  --password your-password \
  --org kingsoft \
  --bucket metrics
```

### åˆå§‹æ•°æ®å¯¼å…¥

**å¯¼å…¥æ¼”ç¤ºæ•°æ®:**
```bash
# å¯¼å…¥ä¼šè¯æ•°æ®
curl -X POST http://localhost:8080/api/admin/import-demo-data \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## å¥åº·æ£€æŸ¥

### æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡
docker-compose ps

# æ£€æŸ¥å‰ç«¯
curl -I http://localhost:3000

# æ£€æŸ¥åç«¯API
curl -I http://localhost:8080/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
curl -I http://localhost:8080/api/health/db
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f postgres
```

## SSL/TLS é…ç½®

### ä½¿ç”¨ Let's Encrypt

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
echo "0 12 * * * /usr/bin/certbot renew --quiet" | sudo crontab -
```

### ä½¿ç”¨è‡ªç­¾åè¯ä¹¦

```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout ./ssl/private.key \
  -out ./ssl/certificate.crt
```

## ç›‘æ§é…ç½®

### Prometheus + Grafana

```bash
# å¯åŠ¨ç›‘æ§æœåŠ¡
docker-compose -f docker-compose.monitoring.yml up -d

# è®¿é—®Grafana
open http://localhost:3001
# é»˜è®¤ç”¨æˆ·å/å¯†ç : admin/admin
```

### åŸºç¡€ç›‘æ§æŒ‡æ ‡

- **åº”ç”¨å¥åº·çŠ¶æ€**: HTTPå¥åº·æ£€æŸ¥
- **å“åº”æ—¶é—´**: APIå“åº”æ—¶é—´ç›‘æ§
- **é”™è¯¯ç‡**: 4xx/5xxé”™è¯¯ç»Ÿè®¡
- **èµ„æºä½¿ç”¨**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡

## å¤‡ä»½æ¢å¤

### æ•°æ®å¤‡ä»½

```bash
# PostgreSQL å¤‡ä»½
docker-compose exec postgres pg_dump -U kingsoft_user kingsoft > backup.sql

# InfluxDB å¤‡ä»½
docker-compose exec influxdb influx backup /tmp/backup
docker cp kingsoft-influxdb:/tmp/backup ./influxdb-backup
```

### æ•°æ®æ¢å¤

```bash
# PostgreSQL æ¢å¤
docker-compose exec -T postgres psql -U kingsoft_user kingsoft < backup.sql

# InfluxDB æ¢å¤
docker cp ./influxdb-backup kingsoft-influxdb:/tmp/backup
docker-compose exec influxdb influx restore /tmp/backup
```

## å¸¸è§é—®é¢˜

### ç«¯å£å†²çª

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ï¼š

```yaml
services:
  frontend:
    ports:
      - "8001:80"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
  backend:
    ports:
      - "8081:8080"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

### å†…å­˜ä¸è¶³

å¯¹äºä½å†…å­˜ç¯å¢ƒï¼Œå¯ä»¥è°ƒæ•´æœåŠ¡é…ç½®ï¼š

```yaml
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
```

### æ•°æ®åº“è¿æ¥é—®é¢˜

æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼š

```bash
# æ£€æŸ¥PostgreSQL
docker-compose exec postgres pg_isready

# æ£€æŸ¥è¿æ¥
docker-compose exec backend npm run db:test
```

## æ€§èƒ½ä¼˜åŒ–

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

**1. å¯ç”¨ç¼“å­˜**
```bash
# Redis ç¼“å­˜é…ç½®
export REDIS_CACHE_TTL=3600
export ENABLE_QUERY_CACHE=true
```

**2. æ•°æ®åº“ä¼˜åŒ–**
```sql
-- PostgreSQL é…ç½®ä¼˜åŒ–
ALTER SYSTEM SET shared_buffers = '256MB';
ALTER SYSTEM SET effective_cache_size = '1GB';
```

**3. å‰ç«¯ä¼˜åŒ–**
```bash
# å¯ç”¨Gzipå‹ç¼©
nginx_conf="gzip on; gzip_types text/plain text/css application/json;"
```

### æ‰©å®¹æŒ‡å—

**æ°´å¹³æ‰©å®¹åç«¯:**
```yaml
services:
  backend:
    deploy:
      replicas: 3  # å¢åŠ å‰¯æœ¬æ•°
```

**æ•°æ®åº“è¯»å†™åˆ†ç¦»:**
```yaml
services:
  postgres-master:
    # ä¸»æ•°æ®åº“é…ç½®
  postgres-slave:
    # ä»æ•°æ®åº“é…ç½®
```

## å®‰å…¨é…ç½®

### ç½‘ç»œå®‰å…¨

```bash
# é˜²ç«å¢™é…ç½®
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

### åº”ç”¨å®‰å…¨

```yaml
# Docker Compose å®‰å…¨é…ç½®
services:
  backend:
    security_opt:
      - no-new-privileges:true
    read_only: true
    user: "1001:1001"
```

## æ•…éšœæ’æŸ¥

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

**1. åº”ç”¨æ— æ³•å¯åŠ¨**
```bash
# æ£€æŸ¥æ—¥å¿—
docker-compose logs backend
# æ£€æŸ¥é…ç½®
docker-compose config
```

**2. æ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose exec postgres pg_isready
# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker-compose exec backend ping postgres
```

**3. å‰ç«¯é¡µé¢ç©ºç™½**
```bash
# æ£€æŸ¥æ„å»ºäº§ç‰©
docker-compose exec frontend ls -la /usr/share/nginx/html
# æ£€æŸ¥Nginxé…ç½®
docker-compose exec frontend nginx -t
```

## å‡çº§æŒ‡å—

### åº”ç”¨å‡çº§

```bash
# 1. å¤‡ä»½æ•°æ®
./scripts/backup.sh

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# 4. æ»šåŠ¨æ›´æ–°
docker-compose up -d --force-recreate
```

### æ•°æ®åº“è¿ç§»

```bash
# æ‰§è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec backend npm run migrate:latest

# éªŒè¯è¿ç§»ç»“æœ
docker-compose exec backend npm run migrate:status
```

---

## è·å–æ”¯æŒ

- ğŸ“š **å®Œæ•´æ–‡æ¡£**: [éƒ¨ç½²è¿ç»´æŒ‡å—](./éƒ¨ç½²è¿ç»´æŒ‡å—.md)
- ğŸ› **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/your-org/kingsoft-admin/issues)
- ğŸ’¬ **æŠ€æœ¯æ”¯æŒ**: support@kingsoft.com
- ğŸ“ **ç´§æ€¥è”ç³»**: +86-400-XXX-XXXX

---

**æœ€åæ›´æ–°**: 2024-08-21  
**é€‚ç”¨ç‰ˆæœ¬**: KingSoft v1.0+